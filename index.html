<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>แบบสอบถามความพึงพอใจ</title>

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      background: #f5f5f5;
      padding: 16px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    h2 { margin-top: 0; }
    label { display:block; margin-top:12px; }
    select, textarea, input, button {
      width: 100%;
      margin-top: 6px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: #06c755;
      color: #fff;
      border: none;
      font-weight: bold;
      margin-top: 16px;
    }
    .big {
      font-size: 20px;
      font-weight: bold;
    }
  </style>
</head>

<body>

<div class="card" id="status">
  กำลังโหลดแบบสอบถาม...
</div>

<form id="surveyForm" class="card" style="display:none">

  <label>เบอร์โทร (ไม่บังคับ)</label>
  <input name="phone" placeholder="08xxxxxxxx" />

  <!-- คำถาม 1–24 -->
  <label>1) รู้จักเราผ่านช่องทางใด</label>
  <select name="q1" required>
    <option value="">เลือก</option>
    <option>Facebook</option>
    <option>Instagram</option>
    <option>TikTok</option>
    <option>เพื่อนแนะนำ</option>
    <option>อื่นๆ</option>
  </select>

  <label>2) พึงพอใจโดยรวมหรือไม่</label>
  <select name="q2" required><option value="">เลือก</option><option>Yes</option><option>No</option></select>

  <label>3) รู้สึกผ่อนคลายระหว่างรับบริการหรือไม่</label>
  <select name="q3" required><option value="">เลือก</option><option>Yes</option><option>No</option></select>

  <label>4) คะแนนประสบการณ์ (1–5)</label>
  <select name="q4" required><option value="">เลือก</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

  <label>5) แพทย์อธิบายชัดเจนหรือไม่</label>
  <select name="q5" required><option value="">เลือก</option><option>Yes</option><option>No</option></select>

  <label>6) แพทย์เข้าใจความต้องการหรือไม่ (1–5)</label>
  <select name="q6" required><option value="">เลือก</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

  <label>7) ความเป็นมืออาชีพของแพทย์ (1–5)</label>
  <select name="q7" required><option value="">เลือก</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

  <label>8) ความใส่ใจระหว่างทำหัตถการ (1–5)</label>
  <select name="q8" required><option value="">เลือก</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

  <label>9) พนักงานสุภาพหรือไม่</label>
  <select name="q9" required><option value="">เลือก</option><option>Yes</option><option>No</option></select>

  <label>10) ไม่กดดันการขายหรือไม่</label>
  <select name="q10" required><option value="">เลือก</option><option>Yes</option><option>No</option></select>

  <label>11) ความรวดเร็ว (1–5)</label>
  <select name="q11" required><option value="">เลือก</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

  <label>12) การดูแลเอาใจใส่ (1–5)</label>
  <select name="q12" required><option value="">เลือก</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

  <label>13) สถานที่สะอาดหรือไม่</label>
  <select name="q13" required><option value="">เลือก</option><option>Yes</option><option>No</option></select>

  <label>14) อุปกรณ์ดูปลอดภัยหรือไม่</label>
  <select name="q14" required><option value="">เลือก</option><option>Yes</option><option>No</option></select>

  <label>15) ความสะอาด (1–5)</label>
  <select name="q15" required><option value="">เลือก</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

  <label>16) บรรยากาศโดยรวม (1–5)</label>
  <select name="q16" required><option value="">เลือก</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

  <label>17) ราคาเหมาะสมหรือไม่</label>
  <select name="q17" required><option value="">เลือก</option><option>Yes</option><option>No</option></select>

  <label>18) ความคุ้มค่า (1–5)</label>
  <select name="q18" required><option value="">เลือก</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

  <label>19) ความชัดเจนของราคา (1–5)</label>
  <select name="q19" required><option value="">เลือก</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

  <label>20) จะกลับมาใช้บริการอีกหรือไม่</label>
  <select name="q20" required><option value="">เลือก</option><option>Yes</option><option>No</option></select>

  <label>21) จะแนะนำให้ผู้อื่นหรือไม่</label>
  <select name="q21" required><option value="">เลือก</option><option>Yes</option><option>No</option></select>

  <label>22) โอกาสแนะนำ (1–5)</label>
  <select name="q22" required><option value="">เลือก</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

  <label>23) สิ่งที่ชอบมากที่สุด</label>
  <textarea name="q23"></textarea>

  <label>24) สิ่งที่ควรปรับปรุง</label>
  <textarea name="q24"></textarea>

  <button type="submit">ส่งแบบสอบถาม</button>
</form>

<div class="card" id="result" style="display:none"></div>

<script>
const LIFF_ID = "2008700231-4yv8fOOG";
const API_URL = "https://script.google.com/macros/s/AKfycbzdNd9Mnktis-gYsKiGlkevV05lDlpaZJeBhWB72Citc3f3AyNETFrFnrqg5pNT5k1v/exec";

let USER_ID = "";

(async function init(){
  await liff.init({ liffId: LIFF_ID });

  if (!liff.isLoggedIn()) {
    liff.login();
    return;
  }

  const friendship = await liff.getFriendship();
  if (!friendship.friendFlag) {
    document.getElementById("status").innerHTML =
      "<div class='big'>กรุณาเพิ่มเพื่อน LINE Official Account ก่อน</div>";
    return;
  }

  const profile = await liff.getProfile();
  USER_ID = profile.userId;

  document.getElementById("status").style.display = "none";
  document.getElementById("surveyForm").style.display = "block";
})();

document.getElementById("surveyForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const formData = new FormData(e.target);
  const payload = Object.fromEntries(formData.entries());
  payload.line_user_id = USER_ID;

  const res = await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body: JSON.stringify(payload)
  });

  const out = await res.json();

  document.getElementById("surveyForm").style.display = "none";
  document.getElementById("result").style.display = "block";
  document.getElementById("result").innerHTML =
    out.reward_status === "REWARD"
    ? "<div class='big'>✅ รับของรางวัลได้</div>"
    : "<div class='big'>❌ เคยรับของรางวัลแล้ว</div>";
});
</script>

</body>
</html>
